<!DOCTYPE html>
<html>
<meta http-equiv="Content-Security-Policy"
      content="img-src * 'self' data:; default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://maps.googleapis.com https://fonts.googleapis.com">


<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Prius Taxi</title>

  <script type="text/javascript" charset="utf-8" src="/www/js/cordova.js"></script>
  <script type="text/javascript" charset="utf-8" src="/www/js/io.js"></script>
  <script type="text/javascript" charset="utf-8" src="/www/js/func.js"></script>


  <script type="text/javascript" charset="utf-8" src="js/init.js"></script>
</head>
<style>
  body {
    color: white;
    margin: 0px;
    padding: 0px;
  }

  a {
    text-decoration: none;
    color: white;
  }
</style>
<body bgcolor=#e3b202>

<!--<div style='width:256px; height:256px; position:relative; position:absolute; left:0px; top:0px; z-index:99;' >
    <img   id='myimg' style='width:256px; height:256px;'>
    <div style='position:absolute; left:0px; top:0px; background-color:red; width:7px; height:7px;' id='persona'></div>
</div>-->
<!-- MOUSE OVER LAYER -->


<div id='fanjara' style='position:relative; overflow:hidden; width:400px; height:600px;'>

  <div style='position:fixed; left:0px; top:0px; width:100%; height:50px; background-color:white; z-index:211; '>
    <a style='float:left; margin-top:7px; margin-left: 7px;' href='Javascript: show_settings();'><img
            src='but_info.png'></a>
    <!--	<div id='infodiv' style='float:right;  color:Black; display:none;'></div>-->
    <a style='float:right; margin-top:7px; margin-right: 7px; ' href='Javascript: show_settings();' id='regbut'><img
            src='but_register.png'></a>


  </div>
  <!-- MAIN MAP -->
  <!--<div id='mouser' name='mouser' style='position:fixed; left:0px; top:50px; width:355px; height:500px; z-index:250; display:none;' ontouchstart="mdown(event);" ontouchend="mup(event);"  ontouchmove="getmousecoord(event);" ></div>-->


  <script>

      var MyLat;
      var MyLong;

      function initMap() {

          MyLat = 41.718287;
          MyLong = 44.778728;

          var myLatLng = {lat: MyLat, lng: MyLong};

          gmap = new google.maps.Map(document.getElementById('gmap'), {
              zoom: 18,
              center: myLatLng,
              zIndex: 70,

              disableDefaultUI: true


          });

          var myicon = {
              url: "pin.svg", // url
              scaledSize: new google.maps.Size(30, 36), // size
              origin: new google.maps.Point(0, 0), // origin
              anchor: new google.maps.Point(15, 18), // anchor
              ratation: 30
          };

          var caricon = {
              url: "car.svg", // url
              scaledSize: new google.maps.Size(50, 50), // size
              origin: new google.maps.Point(0, 0), // origin
              anchor: new google.maps.Point(25, 25), // anchor

          };


          MyMarker = new google.maps.Marker({
              position: myLatLng,
              map: gmap,
              icon: myicon

          });

      }

      //  mapTypeId: 'satellite',

  </script>
  <style>

    td {
      font-size: 10px;
    }
  </style>

  <div id='charcho' style='position:fixed; left:0px; top:50px; width:365px; height:600px;  z-index:1;'>
    <div id='mainw' style='position:absolute; left:0px; top:0px; width:600px; height:600px; '>
      <div id="gmap" style='position:absolute; left:0px; top:0px; height:600px; width:365px; display:block;'></div>

    </div>
  </div>

  <script async defer
          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAFY47FE__z9AvRLBoYG0T2XeOTiHdwzOQ&callback=initMap&language=ka"></script>

  <div id='arrived_screen'
       style='display:none; position:fixed; top:50px; left:0px;  width:400px; height:620px; z-index:300; background-color:#e3b202; color:white; '>

    <br><br><br><br><br><br><br><br><br><br><br>
    <center>თქვენი ტაქსი ადგილზეა<br><Br><a href='javascript: chamovdivar();'
                                            style='color:white; background-color:green; padding:10px; text-align:center; '>ჩამოვდივარ</a>
    </center>
    <br><br>
    <center>
      <div id='taxi_number' style='color:white;'></div>
  </div>


  <div id='GPS_search_screen'
       style='display:inline; position:fixed; top:0px; left:0px;  width:365px; height:650px; z-index:301; background-color:#e3b202; color:white; '>
    <br><br><br><br><br><br><br><br>
    <center><img src='taxi_icon.png'><br><br>... მიმდინარეობს თქვენი ლოკაციის დადგენა ...</center>
  </div>

  <div id='taxi_search_screen'
       style='display:none; position:fixed; top:0px; left:0px;  width:365px; height:650px; z-index:302; background-color:#e3b202; color:white; '>
    <br><br><br><br><br><br><br><br>
    <center><img src='taxi_icon.png'><br><br>... უახლოესი თავისუფალი ტაქსის ძიება ...</center>
  </div>


  <!--<div id='profile_div' style='position:absolute; left:0px; top:0px; width:600px; height:600px; z-index:252; background:URL(semitrans.png); visibility:hidden;'>
      <table width=100% cellspacing=0 cellpadding=0 height=100% border=1>
          <tr><td onmouseup='hide_profile();' onclick="hide_profile();" colspan=3></td></tr>
          <tr><td onmouseup='hide_profile();' onclick="hide_profile();"></td>
          <td>
              <img src='http://developer.design.ge/geotaxi/taxicar.jpg' width=100px><br>
              &#4315;&#4304;&#4316;&#4325;&#4304;&#4316;&#4312;&#4321;&#32;&#4315;&#4317;&#4307;&#4308;&#4314;&#4312;: Mercedes<br>
              მანქანის ფერი: მწვანე<br>
              მძღოლი: ანდრო შველიძე<br>
              <a href='Javascript: call_taxi()'>გამოძახება</a>
          </td>
          <td onmouseup='hide_profile();' onclick="hide_profile();"></td></tr>
          <tr><td onmouseup='hide_profile();' onclick="hide_profile();" colspan=3></td></tr>
          </table>
  </div>-->

  <!--<div id="geopos_short" style='width:100%; position:absolute; left:0px; top:50px; z-index:220; background-color:black; filter: alpha(opacity=50);
      -moz-opacity: 0.5; -khtml-opacity: 0.5;  opacity: 0.5;'>Finding geolocation...</div>-->


  <div id='chat_div' style='position:fixed; right:10px; bottom:50px; z-index:254;  '>
    <a href='Javascript: chat_click();' style='position:absolute; top:-25px; right:0px;'><img src='chat.svg'
                                                                                              style='width:50px; height:50px;'></a>
    <div id='chat_window' style='display:inline; width:98%; height:200px; background-color:white; display:none;'>
      <div id='chat_txt'
           style='width:99%; border:1px solid gray; height:150px; overflow:auto; background-color:white; color:#e3b202; border-radius:5px;'></div>
      <input type='text' size=30 id='chat_send_text' style='z-index:305; text-size:16px;' onkeyup='chat_key(event);'>
      <!--<input type='button' value='send' onclick='chat_send();' style='z-index:305;'>-->
    </div>
  </div>

  <a id='call_but' style='position:fixed; bottom:60px; left:80px; height:100px; width:210px; z-index:252;  '
     href='Javascript: call_taxi();'><img src='gamodzaxeba.svg' style='width:210px; height:100px;'></a>


  <a href='Javascript: setme();' style='position:fixed; top:60px; right:leftpx; margin:5px; z-index:252; '><img
          id='cbut' src='center.svg' style='width:50px; height:50px;'></a>
  <!--<a href='Javascript: show_settings();' style='position:fixed; top:55px; right:5px; margin:5px; z-index:252;' ><img src='settings.png'></a>-->


  <div id="bottom_menu"
       style=' width:100%; position:fixed; bottom:0px; left:0px; height:90px; z-index:251; background-color:#3f3f3f; filter: alpha(opacity=90);	-moz-opacity: 0.9; -khtml-opacity: 0.9;  opacity: 0.9;   '>
    <img src='phone.png'>
    <div id='info_text' name='info_text' style=' float:right; color:white; padding:5px; '></div>

    <div id='certilebi' name='certilebi'
         style=' position:fixed; bottom:0px; left:0px; width:100%; background-color:#ffce00;'>
      <table width=100%>
        <Tr>
          <td>დაწყება:</td>
          <Td>
            <input type='radio' name='startp' id='startp_1' onchange='change_start();' checked> მიმდიანრე ლოკაცია &nbsp;&nbsp;
            <input type='radio' name='startp' id='startp_1' onchange='change_start();'> მითითება რუკაზე
          </td>
        </tr>
        <Tr>
          <td>დასრულება:</td>
          <Td>
            <input type='radio' name='endp' id='endp_1' onchange='change_start();' checked> ღია &nbsp;&nbsp; <input
                  type='radio' name='endp' id='endp_1' onchange='change_start();'> მითითება რუკაზე
          </td>
        </tr>

      </table>


    </div>
  </div>

</div>

<div style='position:fixed; left:0px; top:0px; display:none; z-index:10000; height:20%; width:100%; color:red; font-weight:Bold; background:white;'
     id='nogps'>
  <Br><Br><Br>
  <Center>ვერ ხერხდება GPS ლოკაცის მიღება</center>
</div>


<div style='position:fixed; left:0px; top:0px; display:none; z-index:10001; height:20%; width:100%; color:red; font-weight:Bold; background:white;'
     id='myint'>
  <Br><Br><Br>
  <Center>ჩართეთ ინტერნეტ კავშირი</center>
</div>


<div id='settings_sheet' style='visibility:hidden; position:absolute; left:0px; top:0px; padding:10px; width:355px;'>
  <br>
  <div id='mydiv'></div>
  <br>
  <p id="geopos" style='display:none;'>Finding geolocation...</p>
  <br><br><br><Br><br>

  <div id='erorebi' style='display:none;'>Tilebi (zoom:16)</div>

  <center>
    <b>პროფილი</b>
    <div id='login_page' style='width:355px; '>
      <table>
        <tr>
          <td style='font-size:12px;'>მობ. ან ელ-ფოსტა:</td>
          <td><input type='text' id='myname' name='myname' value='youuser' Placeholder="მობ. ან ელ-ფოსტა" size=16></td>
        </tr>
        <tr>
          <td style='font-size:12px;'>პაროლი:</td>
          <td><input type='password' id='mypass' name='mypass' value='yourpass' placeholder="პაროლი" size=12></td>
          <td rowspan=2><a style='' href='Javascript: saveuser();'><img src='save.png' width=20px></a></td>
        </tr>
      </table>
      <Br><br>
      <a href='#' onclick="window.open('http://developer.design.ge/prius/reg.php', '_system');"
         style='background-color:white; border:1px solid gray; display:block; width:150px; color:black; padding:5px;'>რეგისტრაცია</a>
    </div>

    <div id='loggedin_page' style='width:355px;'>
      <div id='loggedin_info'></div>
      <a href='Javascript: logout();'
         style='background-color:white; border:1px solid gray; display:block; width:150px; color:black; padding:5px;'>გამოსვლა</a>
    </div>
    <br>


    <!--		<input type='checkbox' id='ignor_cache' name='ignor_cache' onchange='cignore();'> რუქის ქეშის იგნორირება<br>
            <input type='checkbox' id='ignor_cache_on_wifi' name='ignor_cache_on_wifi' onchange='cignorewifi();' checked> რუქის ქეშის იგნორირება WiFi-სას<br>-->
    <a href='Javascript: show_map();'
       style='background-color:white; border:1px solid gray; display:block; width:150px; color:black; padding:5px; '>უკან
      დაბრუნება</a></center>
  </center>
</div>
</div>

<script>
    var last_chat = 0;

    var chatopened = 0;

    function chat_key(e) {

        if (e.keyCode == 13) {
            send_chat();
        }
    }


    function chat_click() {
        if (chatopened == 0) {
            document.getElementById("chat_window").style.display = "inline";
            document.getElementById("chat_div").style.bottom = "400px";
            chatopened = 1;
        }
        else {
            document.getElementById("chat_window").style.display = "none";
            document.getElementById("chat_div").style.bottom = "60px";
            chatopened = 0;
        }

    }

    function chat_send() {
        chat_txt = document.getElementById("chat_send_text").value;
        document.getElementById("chat_send_text").value = "";
        url = "http://developer.design.ge/geotaxi/chat.php?send=1&myid=" + myid + "&chat_txt=" + chat_txt;
        console.log("send chat: " + url);
        gamehttp.open('GET', url, true);
        gamehttp.send(null);
    }

    function change_status(newstat) {
        console.log("status change: " + newstat + " / " + mystatus);
        if (newstat != mystatus) {

            if (newstat == 1) {

                uplimit = 1;
                document.getElementById("taxi_search_screen").style.display = "inline";
                document.getElementById("info_text").innerHTML = "მიმდინარეობს ტაქსის ძიება";
                document.getElementById("call_but").style.display = "none";
                document.getElementById("arrived_screen").style.display = "none";
            }
            else if (newstat == 2) {
                document.getElementById("taxi_search_screen").style.display = "none";
                uplimit = 1;
                document.getElementById("call_but").style.display = "none";
                document.getElementById("info_text").innerHTML = "ტაქსი მოდის";
                myself = 1;
            }
            else if (newstat == 3) {
                uplimit = 1;
                document.getElementById("taxi_search_screen").style.display = "none";
                document.getElementById("call_but").style.display = "none";
                document.getElementById("arrived_screen").style.display = "inline";
                document.getElementById("taxi_number").innerHTML = "ბორტის ნომერი: " + taxiname;
                myself = 1;
            }
            else if (newstat == 4) {
                uplimit = 1;
                document.getElementById("taxi_search_screen").style.display = "none";
                document.getElementById("call_but").style.display = "none";
                document.getElementById("arrived_screen").style.display = "none";
                document.getElementById("info_text").innerHTML = "ტაქსი გელოდებათ, ბორტი: " + taxiname;

                myself = 1;
            }
            else if (newstat == 5) {
                uplimit = 5;
                document.getElementById("taxi_search_screen").style.display = "none";
                document.getElementById("call_but").style.display = "none";
                document.getElementById("arrived_screen").style.display = "none";
                document.getElementById("info_text").innerHTML = "თქვენ მოძრაობთ";
                myself = 1;
            }

            else if (newstat == 0) {
                uplimit = 5;
                document.getElementById("call_but").style.display = "inline";
                document.getElementById("taxi_search_screen").style.display = "none";
                document.getElementById("arrived_screen").style.display = "none";
            }
            mystatus = newstat;
        }


    }

    function chamovdivar() {
        if (MyUser != "nouser" && MyUser != "") {
            url = "http://developer.design.ge/geotaxi/chamovdivar.php?uname=" + MyUser + "&pass=" + MyPass + "&lat=" + MyLat + "&long=" + MyLong + "&unique=" + myid;
        }
        else {
            url = "http://developer.design.ge/geotaxi/chamovdivar.php?lat=" + MyLat + "&long=" + MyLong + "&unique=" + myid;
        }
        console.log("taxi chamovdivar: " + url);
        gamehttp.open('GET', url, true);
        gamehttp.send(null);

    }

    function cignore() {
        if (document.getElementById("ignor_cache").checked == true) {
            cache_ignore = 1;
        }
        else {
            cache_ignore = 0;
        }
    }

    function cignorewifi() {
        if (document.getElementById("ignor_cache_on_wifi").checked == true) {
            cache_ignore_wifi = 1;
        }
        else {
            cache_ignore_wifi = 0;
        }
    }

    function setme() {
        console.log("setme");
        if (myself == 0) {
            myself = 1;
            document.getElementById("cbut").src = 'center_sel.svg';
        }
        else {
            myself = 0;
            document.getElementById("cbut").src = 'center.svg';
        }

    }

    //document.getElementById("maptype").value=1;
    var curmap = 1;

    function changemap() {
        console.log("change map");
        curmap = document.getElementById("maptype").value;
        oxt = 0;
        oyt = 0;
        setmypos();
    }

    var curwindow = 0;

    function show_settings() {

        checkConnection();

        curwindow = 1;
        document.getElementById("fanjara").style.visibility = "hidden";
        document.getElementById("settings_sheet").style.visibility = "visible";
    }


    function show_map() {
        curwindow = 0;
        document.getElementById("fanjara").style.visibility = "visible";
        document.getElementById("settings_sheet").style.visibility = "hidden";
    }


    function stopScrolling(touchEvent) {
        touchEvent.preventDefault();
    }


    //document.body.addEventListener( 'touchmove' , stopScrolling , false );
    var mcl = "orange";


    function DrawUsers() {

        if (mystatus == 2) {

            console.log("draw taxi: " + taxilong + " / " + taxilat + " onme:" + myself);


            document.getElementById("taxibox").style.visibility = "visible";
            document.getElementById("taxitext").innerHTML = taxiname;


        }
    }


    function DrawHomePos() {
        console.log("drawing home pos");


    }


    var but1 = 0;

    var t2x = 0;
    var t2y = 0;

    var tdist = 0;
    var tdist_old = 0;


    function mdown(event) {

    }


    var sfinx = 0;
    var finy = 0;

    function getmousecoord(event) {
        console.log("get mouse coord movedi");

    }

    function mup(event) {
        console.log("mouse up");

    }


    //document.ontouchmove = function (e) {  console.log("object: "+e.target.id);};


    document.getElementById("fanjara").style.width = sx + "px";
    document.getElementById("fanjara").style.height = sy + "px";

    //document.getElementById("mouser").style.width=sx+"px";
    //document.getElementById("mouser").style.height=sy+"px";


    function zoomme(sait) {

    }

    var myloginid = 0;


    function saveuser() {
        if (document.getElementById("myname").value != "" && document.getElementById("mypass").value != "") {
            MyUser = document.getElementById("myname").value;
            MyPass = document.getElementById("mypass").value;
        }
        else {
            MyUser = "nouser";
            MyPass = "nopass";
        }

        WriteData();


        url = "http://developer.design.ge/prius/login.php?login=1&unique=" + myid + "&myuser=" + MyUser + "&mypass=" + MyPass;
        console.log("login: " + url);
        gamehttp.open('GET', url, true);
        gamehttp.send(null);

        if (started == 0) {
            Start();
        }
    }


    var curx;
    var cury;
    var oxt = 0;
    var oyt = 0;
    var tilef = 0;

    var kartX;
    var kartY;

    function setmypos() {
        if (window.navigator.onLine == false) {
            document.getElementById("myint").style.display = "inline";
        }
        else {
            document.getElementById("myint").style.display = "none";
        }


        DrawHomePos();

        var myLatLng = {lat: MyLat, lng: MyLong};
        MyMarker.setPosition(myLatLng);
        gmap.panTo(myLatLng);
        console.log("move marker");
    }

    function check_user_click() {

    }

    function hide_profile() {
        document.getElementById("profile_div").style.visibility = "hidden";
//	document.getElementById("mouser").style.visibility="visible";
        curtaxi = -1;
    }

    var curtaxi = -1;

    function show_profile(tid) {
        var curtaxi = tid;
        document.getElementById("profile_div").style.visibility = "visible";
//	document.getElementById("mouser").style.visibility="hidden";
    }

    var callingtaxi = 0;

    function call_taxi() {
        if (mytel == "" || mytel.length < 6) {
            mytel = prompt("რა ნომერზე დაგიკავშირდეთ?");
            WriteData();
        }

        if ((mytel != "" && mytel != null ) || mytel.length >= 6) {
            if (MyUser != "nouser" && MyUser != "") {
                url = "http://developer.design.ge/geotaxi/call.php?uname=" + MyUser + "&pass=" + MyPass + "&lat=" + MyLat + "&long=" + MyLong + "&unique=" + myid + "&tel=" + mytel;
            }
            else {
                url = "http://developer.design.ge/geotaxi/call.php?lat=" + MyLat + "&long=" + MyLong + "&unique=" + myid + "&tel=" + mytel;
            }
            callingtaxi = 1;
            console.log("taxi call: " + url);
            gamehttp.open('GET', url, true);
            gamehttp.send(null);

        }
    }


    function logout() {
        myloginid = 0;
        WriteData();
        document.getElementById("regbut").style.display = "inline";
        document.getElementById("myname").value = "";
        document.getElementById("mypass").value = "";
        document.getElementById("loggedin_page").style.display = "none";
        document.getElementById("login_page").style.display = "inline";
    }

    function fail(error) {
        console.log(error.code);
    }
</script>
</body>
</html>
